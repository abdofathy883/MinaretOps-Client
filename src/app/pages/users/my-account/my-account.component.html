<div class="container my-4">

 <div class="card mb-4 px-3 py-sm-3">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h5 class="mb-1">
          اهلا يا, 
          {{ currentUser?.firstName + " " + currentUser?.lastName }}
        </h5>
        <p class="mb-0">تقدر تعدل بياناتك من هنا</p>
        <!-- <p class="mb-0">عدل بس البيانات اللي محتاجها وسيب الباقي زي ما هو</p> -->
        <p class="mb-0">ومتنساش تشوف تاسكاتك من هنا <a routerLink="/tasks">التاسكات</a></p>
      </div>
      <div class="col-md-4 text-end d-flex justify-content-end">
        <button
          class="mt-1  text-decoration-none text-dark btn border-0"
          (click)="logout()"
        >
          <div class="">
            <i class="bi bi-box-arrow-right fs-2 mb-2 text-danger"></i>
            <h6 class="card-title text-danger">تسجيل الخروج</h6>
          </div>
        </button>
      </div>
    </div>
  </div>


  <!-- Error Message -->
  @if (errorMessage) {
  <div class="alert alert-danger">
    {{ errorMessage }}
  </div>
  }

  <!-- Success Message -->
  @if (successMessage) {
  <div class="alert alert-success">
    {{ successMessage }}
  </div>
  }

  <!-- User Information Section -->
  <div class="card shadow-sm mb-4">
    <div class="card-header form-header">
      <h5 class="mb-0">البيانات الاساسية</h5>
    </div>
    <div class="card-body">
      <form [formGroup]="editUserForm" (ngSubmit)="onSubmit()">
        <div class="row mb-3">
          <div class="col">
            <label for="firstName" class="form-label">الاسم الاول</label>
            <input
              type="text"
              class="form-control"
              id="firstName"
              formControlName="firstName"
            />
          </div>
          <div class="col">
            <label for="lastName" class="form-label">الاسم الاخير</label>
            <input
              type="text"
              class="form-control"
              id="lastName"
              formControlName="lastName"
            />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <label for="email" class="form-label">البريد الالكتروني</label>
            <input
              type="email"
              class="form-control"
              id="email"
              formControlName="email"
            />
          </div>
          <div class="col">
            <label for="phoneNumber" class="form-label">الهاتف</label>
            <input
              type="tel"
              class="form-control"
              id="phoneNumber"
              formControlName="phoneNumber"
            />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <label for="paymentNumber" class="form-label"
              >رقم المحفظة او انستاباي</label
            >
            <input
              type="tel"
              class="form-control"
              id="paymentNumber"
              formControlName="paymentNumber"
            />
          </div>
          <div class="col">
            <label for="city" class="form-label">المدينة</label>
            <input
              type="text"
              class="form-control"
              id="city"
              formControlName="city"
            />
          </div>
        </div>

        <div class="mb-3">
          <label for="street" class="form-label">العنوان التفصيلي</label>
          <textarea name="street" id="street" class="form-control" formControlName="street"></textarea>
        </div>

        <!-- Submit Button Section -->
        <button type="submit" class="add-btn">
          @if (isLoading) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          جاري تعديل البيانات... 
        } @else {
          <i class="bi bi-check-circle me-2"></i>
          تعديل البيانات

        }
        </button>
      </form>
    </div>
  </div>

  <!-- Password Update Section -->
  <div class="card shadow-sm">
    <div class="card-header form-header">
      <h5 class="mb-0">
        <i class="bi bi-shield-shaded"></i>
        تغيير كلمة المرور
      </h5>
    </div>
    <div class="card-body">
      <form [formGroup]="passwordForm" (ngSubmit)="updatePassword()">
        <div class="mb-3">
          <label for="currentPassword" class="form-label"
            >كلمة المرور الحالية</label
          >
          <input
            type="password"
            id="currentPassword"
            name="currentPassword"
            formControlName="currentPassword"
            class="form-control"
            required
          />
          @if (passwordForm.get('currentPassword')?.invalid &&
          passwordForm.get('currentPassword')?.touched) {
          <div class="error-message">كلمة المرور الحالية مطلوبة</div>
          }
        </div>

        <div class="row mb-3">
          <div class="col">
            <label for="newPassword" class="form-label"
              >كلمة المرور الجديدة</label
            >
            <input
              type="password"
              id="newPassword"
              name="newPassword"
              formControlName="newPassword"
              class="form-control"
              required
            />
            @if (passwordForm.get('newPassword')?.invalid &&
            passwordForm.get('newPassword')?.touched) {
            <div class="error-message">
              كلمة المرور الجديدة مطلوبة ويجب أن تكون 6 أحرف على الأقل
            </div>
            }
          </div>
          <div class="col">
            <label for="confirmNewPassword" class="form-label"
              >تأكيد كلمة المرور الجديدة</label
            >
            <input
              type="password"
              id="confirmNewPassword"
              name="confirmNewPassword"
              formControlName="confirmNewPassword"
              class="form-control"
              required
            />
            @if (passwordForm.get('confirmNewPassword')?.invalid &&
            passwordForm.get('confirmNewPassword')?.touched) {
            <div class="error-message">تأكيد كلمة المرور مطلوب</div>
            } @if (passwordForm.errors?.['passwordMismatch'] &&
            passwordForm.get('confirmNewPassword')?.touched) {
            <div class="error-message">
              كلمة المرور الجديدة وتأكيدها غير متطابقين
            </div>
            }
          </div>
        </div>

        <!-- Submit Button Section -->
        <button type="submit" class="add-btn">
          @if (isLoading) {
          <span class="spinner-border spinner-border-sm me-2"></span>
          جاري تحديث الرقم السري ... }
          <i class="bi bi-check-circle me-2"></i>
          تحديث الرقم السري
        </button>
      </form>
    </div>
  </div>
</div>
