<section class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-0">الخزنات</h1>
      <p class="text-muted mb-0">إدارة جميع الخزنات</p>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-4">
      <label for="currencyFilter" class="form-label">فلترة حسب العملة</label>
      <select
        id="currencyFilter"
        class="form-select"
        [value]="selectedCurrencyId()"
        (change)="onCurrencyFilterChange($any($event.target).value)"
      >
        <option disabled selected>اختر عملة</option>
        @for (currency of currencies(); track currency.id) {
          <option [value]="currency.id">
            {{ currency.name }} ({{ currency.code }})
          </option>
        }
      </select>
    </div>
  </div>

  @if (isLoading()) {
    <app-shimmer></app-shimmer>
  }

  @if (!isLoading() && filteredVaults().length > 0) {
    <div class="table-responsive">
      <table class="content-table">
        <thead>
          <tr>
            <th>نوع الخزنة</th>
            <th>الفرع</th>
            <th>العملة</th>
            <th>الرصيد</th>
            <th>الإجراءات</th>
          </tr>
        </thead>
        <tbody>
          @if (unifiedVault()) {
            <tr
              style="cursor: pointer"
              (click)="goToUnifiedVault(unifiedVault()!.currencyId)"
            >
              <td>
                <span class="badge bg-secondary">موحد</span>
              </td>
              <td class="fw-bold">{{ unifiedVault()!.branchName || "موحد" }}</td>
              <td>
                <span class="badge bg-info"
                  >{{ unifiedVault()!.currencyName }} ({{
                    unifiedVault()!.currencyCode
                  }})</span
                >
              </td>
              <td>
                <span
                  [class.text-success]="unifiedVault()!.balance >= 0"
                  [class.text-danger]="unifiedVault()!.balance < 0"
                  class="fw-bold"
                >
                  {{ unifiedVault()!.balance | number: "1.2-2" }}
                  {{ unifiedVault()!.currencyCode }}
                </span>
              </td>
              <td>
                <button
                    class="btn btn-outline-info btn-sm me-2"
                    (click)="
                      goToUnifiedVault(unifiedVault()!.currencyId);
                      $event.stopPropagation()
                    "
                    title="عرض الخزنة الموحدة"
                  >
                    <i class="bi bi-globe"></i>
                    موحد
                  </button>
              </td>
            </tr>
          }
          @for (vault of filteredVaults(); track vault.id) {
            <tr style="cursor: pointer" (click)="goToVault(vault.id)">
              <td>
                  <span class="badge bg-primary">فرع</span>
              </td>
              <td class="fw-bold">{{ vault.branchName || "موحد" }}</td>
              <td>
                <span class="badge bg-info"
                  >{{ vault.currencyName }} ({{ vault.currencyCode }})</span
                >
              </td>
              <td>
                <span
                  [class.text-success]="vault.balance >= 0"
                  [class.text-danger]="vault.balance < 0"
                  class="fw-bold"
                >
                  {{ vault.balance | number: "1.2-2" }} {{ vault.currencyCode }}
                </span>
              </td>
              <td>
                <button
                  class="btn btn-outline-primary btn-sm"
                  (click)="goToVault(vault.id); $event.stopPropagation()"
                  title="عرض التفاصيل"
                >
                  <i class="bi bi-eye"></i>
                  عرض
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  @if (!isLoading() && filteredVaults().length === 0) {
    <div class="text-center py-5">
      <div class="empty-state">
        <i class="bi bi-safe" style="font-size: 4rem; color: #ccc"></i>
        <h3 class="mt-3">لا توجد خزنات حتى الآن</h3>
        <p class="text-muted">
          الخزنات يتم إنشاؤها تلقائياً عند إضافة فروع جديدة
        </p>
      </div>
    </div>
  }
</section>
