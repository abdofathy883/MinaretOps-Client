<div class="container my-4">
  <h2>إضافة فترة راتب</h2>

  @if (alertMessage) {
  <div
    class="alert alert-{{ alertType }} alert-dismissible fade show"
    role="alert"
  >
    {{ alertMessage }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  }

  <form [formGroup]="salaryPeriodForm" (ngSubmit)="onSubmit()">
    <div class="card">
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">الموظف</label>
            <span class="text-danger me-2">*</span>
            <select class="form-select" formControlName="employeeId">
              <option value="">اختر الموظف</option>
              @for (emp of employees; track $index) {
              <option [value]="emp.id">
                {{ emp.firstName }} {{ emp.lastName }}
              </option>
              }
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">تاريخ الإنشاء</label>
            <span class="text-danger me-2">*</span>
            <input
              type="date"
              class="form-control"
              formControlName="createdAt"
            />
          </div>
        </div>

        

        <div class="row mb-3">
          <div class="col-md-4">
            <label class="form-label">الراتب الأساسي</label>
            <span class="text-danger me-2">*</span>
            <input
              type="number"
              step="500"
              class="form-control"
              formControlName="salary"
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">المكافأة</label>
            <input
              type="number"
              step="0.01"
              class="form-control"
              formControlName="bonus"
            />
          </div>
          <div class="col-md-4">
            <label class="form-label">الخصومات</label>
            <input
              type="number"
              step="0.01"
              class="form-control"
              formControlName="deductions"
            />
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">ملاحظات</label>
          <textarea
            class="form-control"
            rows="3"
            formControlName="notes"
          ></textarea>
        </div>

        <div class="mb-3">
          <div class="d-flex justify-content-between align-items-center">
            <h5>المدفوعات</h5>
            <button
              type="button"
              class="btn btn-sm btn-primary"
              (click)="addPayment()"
            >
              <i class="bi bi-plus"></i> إضافة دفعة
            </button>
          </div>

          <div formArrayName="salaryPayments">
            @for (payment of salaryPayments.controls; track $index) {
            <div [formGroupName]="$index" class="card my-3">
              <div class="card-body">
                <div class="row">
                  <div class="col-md-5">
                    <label class="form-label">المبلغ</label>
                    <span class="text-danger me-2">*</span>
                    <input
                      type="number"
                      step="0.01"
                      class="form-control"
                      formControlName="amount"
                    />
                  </div>
                  <div class="col-md-5">
                    <label class="form-label">ملاحظات</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="notes"
                    />
                  </div>
                </div>
                <div class="row">
            <div class="col-12 col-md-6 mb-3">
              <label for="currencyId" class="form-label">العملة</label>
              <span class="text-danger me-2">*</span>
              <select name="currencyId" id="currencyId" class="form-select" formControlName="currencyId">
                <option disabled selected>اختر العملة</option>
                @for (currency of vaults; track $index) {
                <option [value]="currency.currencyId">{{ currency.currencyName }}</option>
                }
              </select>
            </div>
            <div class="col-12 col-md-6 mb-3">
              <label for="vaultId" class="form-label">الخزنة</label>
              <span class="text-danger me-2">*</span>
              <select name="vaultId" id="vaultId" class="form-select" formControlName="vaultId">
                <option disabled selected>اختر الخزنة</option>
                @for (vault of vaults; track $index) {
                <option [value]="vault.id">{{ vault.branchName }}</option>
                }
              </select>
            </div>
          </div>
                <div class="col-md-2 d-flex align-items-end">
                  <button
                    type="button"
                    class="btn btn-sm btn-danger"
                    (click)="removePayment($index)"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>
            }
          </div>
        </div>
        <div class=" d-flex gap-3 mt-3">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="isLoading || salaryPeriodForm.invalid"
          >
            @if (isLoading) {
            <span class="spinner-border spinner-border-sm me-2"></span>
            } حفظ
          </button>
          <button type="button" class="btn btn-secondary ms-2" (click)="cancel()">
            إلغاء
          </button>
        </div>
      </div>
    </div>

  </form>
</div>
