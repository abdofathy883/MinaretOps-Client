<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Attendance Dashboard</h2>
    <button class="add-btn" (click)="loadDashboard()" [disabled]="loading">
      <i class="bi bi-arrow-clockwise"></i> تحديث
    </button>
  </div>

  <!-- Loading Spinner -->
   @if (loading) {
       <div class="text-center py-5">
         <div class="spinner-border text-primary" role="status">
           <span class="visually-hidden">Loading...</span>
         </div>
       </div>
   }

  <!-- Error Message -->
   @if (error && !loading) {
       <div class="alert alert-danger" role="alert">
         {{ error }}
       </div>
   }

  <!-- Dashboard Content -->
   @if (!loading && !error && dashboardData) {
       <div class="row g-4">
         <!-- Column 1: Currently Active -->
         <div class="col-md-4">
           <div class="card shadow-sm h-100">
             <div class="card-header bg-success text-white">
               <h5 class="mb-0">
                 <i class="bi bi-people-fill"></i> الحضور
                 <span class="badge bg-light text-dark ms-2">{{ dashboardData.currentlyActiveTotal }}</span>
               </h5>
             </div>
             <div class="card-body">
                @if (dashboardData.currentlyActiveEmployees.length === 0) {
                    <div class="text-center text-muted py-3">
                      لا يوجد موظفين حاضرون حاليا
                    </div>
                }
               <ul class="list-group list-group-flush">
                @for (employee of dashboardData.currentlyActiveEmployees; track $index) {
                    <li class="list-group-item d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="fw-bold">{{ employee.employeeName }}</div>
                            @if (!employee.isOnBreak && employee.workingDuration) {
                                <small class="text-muted">
                                    مدة العمل: {{ shortTimeSpan(employee.workingDuration) }}
                                </small>
                            }
                            @if (employee.isOnBreak) {
                                <small class="text-muted">في استراحة</small>
                            }
                        </div>
                        <span class="status-circle me-3" [ngClass]="getStatusClass(employee.isOnBreak)"></span>
                    </li>
                }
               </ul>
             </div>
           </div>
         </div>
     
         <!-- Column 2: Absent -->
         <div class="col-md-4">
           <div class="card shadow-sm h-100">
             <div class="card-header bg-danger text-white">
               <h5 class="mb-0">
                 <i class="bi bi-x-circle-fill"></i> الغياب
                 <span class="badge bg-light text-dark ms-2">{{ dashboardData.absentTotal }}</span>
               </h5>
             </div>
             <div class="card-body">
                @if (dashboardData.absentEmployees.length === 0) {
                    <div class="text-center text-muted py-3">
                      لا يوجد موظفين غائبون
                    </div>
                }
               <ul class="list-group list-group-flush">
                @for (employee of dashboardData.absentEmployees; track $index) {
                    <li class="list-group-item d-flex align-items-center">
                        <div class="fw-bold">{{ employee.employeeName }}</div>
                      <span class="status-circle status-absent me-3"></span>
                    </li>
                }
               </ul>
             </div>
           </div>
         </div>
     
         <!-- Column 3: On Leave -->
         <div class="col-md-4">
           <div class="card shadow-sm h-100">
             <div class="card-header bg-info text-white">
               <h5 class="mb-0">
                 <i class="bi bi-calendar-check-fill"></i> اجازة
                 <span class="badge bg-light text-dark ms-2">{{ dashboardData.onLeaveTotal }}</span>
               </h5>
             </div>
             <div class="card-body">
                @if (dashboardData.onLeaveEmployees.length === 0) {
                    <div class="text-center text-muted py-3">
                      لا يوجد موظفين في اجازة
                    </div>
                }
               <ul class="list-group list-group-flush">
                @for (employee of dashboardData.onLeaveEmployees; track $index) {
                    <li class="list-group-item d-flex align-items-center">
                        <div class="fw-bold">{{ employee.employeeName }}</div>
                      <span class="status-circle status-leave me-3"></span>
                    </li>
                }
               </ul>
             </div>
           </div>
         </div>
       </div>
   }
</div>